<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>イベント管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 端末の配色に追従（CSS側で未定義時の初期ヒント） -->
  <meta name="color-scheme" content="light dark">
  <!-- LINE公式スクリプトへの事前接続ヒント（任意最適化） -->
  <link rel="preconnect" href="https://static.line-scdn.net" crossorigin>
  <!-- CSS（I/F互換のためパス/バージョンは現状維持） -->
  <link rel="stylesheet" href="/static/events/liff.css?v=6">
</head>

<body>
  <h1>イベント管理</h1>

  <!-- 作成ボタン（押下で作成フローへ） -->
  <button id="btn-create" data-href="/liff/create">イベント作成</button>

  <!-- 一覧（JSで差し込み） -->
  <div id="event-list" aria-live="polite">
    <p class="muted">読み込み中…</p>
  </div>

  <noscript>
    <p class="muted">JavaScriptを有効にしてね</p>
  </noscript>

  <!-- =========================
       イベント作成モーダル
       ========================= -->
  <div id="create-backdrop" class="backdrop" hidden></div>

  <section id="create-dialog" class="dialog" role="dialog" aria-modal="true" aria-labelledby="dlg-title" hidden>
    <div class="dlg-panel">
      <header class="dlg-header">
        <h2 id="dlg-title">イベント作成</h2>
      </header>

      <form id="create-form" class="dlg-body">
        <!-- タイトル（必須） -->
        <label class="row">
          <span>タイトル</span>
          <input id="f-title" name="title" type="text" placeholder="イベント名を入力してね" required>
          <small id="err-title" class="err" hidden>イベント名を入力してね</small>
        </label>

        <!-- 日付（必須）/ 開始時刻（任意） -->
        <div class="row2">
          <label class="subrow">
            <span>日付</span>
            <input id="f-date" name="date" type="date" required>
            <small id="err-date" class="err" hidden>日付を選んでね</small>
          </label>
          <label class="subrow">
            <span>開始時刻</span>
            <input id="f-start" name="start_time" type="time">
          </label>
        </div>

        <!-- 終了入力（左：モード/右：入力） -->
        <div class="row">
          <fieldset class="endpicker">
            <div class="endmode-switch">
              <label class="radio-pill">
                <input type="radio" name="endmode" value="time" checked> 終了時刻
              </label>
              <label class="radio-pill">
                <input type="radio" name="endmode" value="duration"> 所要時間
              </label>
            </div>

            <div class="end-input">
              <label class="subrow when-time" id="row-endtime">
                <span>終了時刻</span>
                <input id="f-end" name="end_time" type="time" placeholder="例: 18:00">
              </label>
              <label class="subrow when-duration" id="row-duration">
                <span>所要時間</span>
                <input id="f-duration" name="duration" type="text" placeholder="例: 1:30 / 90m / 2h / 120">
              </label>
            </div>
          </fieldset>
        </div>

        <!-- 定員（任意） -->
        <label class="row">
          <span>定員</span>
          <input id="f-cap" name="capacity" type="number" inputmode="numeric" min="1" step="1" placeholder="数字を入力してね">
        </label>

        <!-- 共有先グループ -->
        <label class="row" id="row-group-to-share">
          <span>共有するグループ</span>
          <input id="f-group" type="hidden">
          <div id="selected-group" class="sg-pill" style="display:none;align-items:center;gap:8px;margin:6px 0;"></div>
          <div id="group-suggest" class="row" style="display:none;"></div>
          <div id="group-preview" class="sg-preview" style="display:none;">
            <img id="group-icon" alt="">
            <span id="group-name" class="truncate"></span>
          </div>
        </label>

        <!-- 通知（検証OK時に活性化） -->
        <label id="row-notify" class="row" style="display:none;">
          <span>通知</span>
          <input id="f-notify" name="notify" type="checkbox" disabled>
          <small style="margin-left:8px;">イベント作成通知をグループに送る</small>
        </label>
      </form>

      <footer class="dlg-footer">
        <button type="button" id="btn-cancel" class="btn-secondary">やめる</button>
        <button type="button" id="btn-save" class="btn-primary">保存</button>
      </footer>
    </div>
  </section>

  <!-- サーバから渡すLIFF情報（I/F互換のまま） -->
  <script>
    window.LIFF_ID = "{{ LIFF_ID|default_if_none:''|escapejs }}";
    window.LIFF_REDIRECT_ABS = "{{ LIFF_REDIRECT_ABS|escapejs }}";
  </script>
  <!-- 読み込み順：SDK → アプリ本体。DOMContentLoadedで初期化するためdeferでOK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js" defer></script>
  <script src="/static/events/liff.js?v=6" defer></script>
</body>
</html>
